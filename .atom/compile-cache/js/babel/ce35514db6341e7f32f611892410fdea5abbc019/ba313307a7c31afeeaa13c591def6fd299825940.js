'use babel';

Object.defineProperty(exports, '__esModule', {
  value: true
});

var _this = this;

var atom = global.atom;
var Path = require('path');
var FileSystem = require('fs-plus');
var Minimatch = require('minimatch').Minimatch;

var ignoredPatterns = null;
var ignoredFinderPatterns = null;

var logDebug = function logDebug(param1, param2) {
  if (atom.config.get('ftp-remote-edit.dev.debug')) {
    if (param1 && param2) {
      console.log(param1, param2);
    } else if (param1) {
      console.log(param1);
    }
  }
};

exports.logDebug = logDebug;
var showMessage = function showMessage(msg) {
  var type = arguments.length <= 1 || arguments[1] === undefined ? 'info' : arguments[1];

  if (msg instanceof Error) {
    msg = msg.message;
  }

  if (typeof msg !== 'string') {
    msg = 'Unknown error';
  }

  if (type === 'success') {
    atom.notifications.addSuccess('Ftp-Remote-Edit', {
      description: msg
    });
  } else if (type === 'info') {
    atom.notifications.addInfo('Ftp-Remote-Edit', {
      description: msg
    });
  } else {
    atom.notifications.addError('Ftp-Remote-Edit', {
      description: msg
    });
  }
};

exports.showMessage = showMessage;
var getFullExtension = function getFullExtension(filePath) {
  var fullExtension = '';
  var extension = '';
  while (extension = Path.extname(filePath)) {
    fullExtension = extension + fullExtension;
    filePath = Path.basename(filePath, extension);
  }
  return fullExtension;
};

exports.getFullExtension = getFullExtension;
var createLocalPath = function createLocalPath(localpath) {
  try {
    var arrPath = localpath.split(Path.sep);
    arrPath.pop();

    arrPath.reduce(function (tmpPath, dir) {
      tmpPath += Path.sep + dir;
      if (!FileSystem.existsSync(tmpPath)) {
        FileSystem.mkdirSync(tmpPath);
      }
      return tmpPath;
    });
  } catch (err) {
    return err;
  }
};

exports.createLocalPath = createLocalPath;
var deleteLocalPath = function deleteLocalPath(localpath) {
  try {
    if (FileSystem.existsSync(localpath)) {
      FileSystem.readdirSync(localpath).forEach(function (file, index) {
        var curPath = localpath + "/" + file;
        if (FileSystem.lstatSync(curPath).isDirectory()) {
          // recurse
          return deleteLocalPath(curPath);
        } else {
          // delete file
          FileSystem.unlinkSync(curPath);
        }
      });
      FileSystem.rmdirSync(localpath);
    }
  } catch (err) {
    return err;
  }
};

exports.deleteLocalPath = deleteLocalPath;
var moveLocalPath = function moveLocalPath(srclocalpath, targetlocalpath) {
  try {
    var tmp = targetlocalpath.split(Path.sep);
    tmp.pop();
    var parentPath = tmp.join(Path.sep);

    if (!FileSystem.existsSync(parentPath)) {
      FileSystem.makeTreeSync(parentPath);
    }
    if (FileSystem.existsSync(targetlocalpath)) {
      FileSystem.removeSync(targetlocalpath);
    }
    FileSystem.moveSync(srclocalpath, targetlocalpath);
  } catch (err) {
    return err;
  }
};

exports.moveLocalPath = moveLocalPath;
var resetIgnoredPatterns = function resetIgnoredPatterns() {
  ignoredPatterns = null;
};

exports.resetIgnoredPatterns = resetIgnoredPatterns;
var loadIgnoredPatterns = function loadIgnoredPatterns() {
  var ignoredName = undefined,
      ignoredNames = undefined,
      i = undefined,
      len = undefined,
      results = undefined;

  if (!atom.config.get('ftp-remote-edit.tree.hideIgnoredNames')) {
    return;
  }

  if (ignoredPatterns) return ignoredPatterns;
  if (ignoredPatterns == null) ignoredPatterns = [];

  ignoredNames = atom.config.get('core.ignoredNames') != null ? atom.config.get('core.ignoredNames') : [];
  if (typeof ignoredNames === 'string') {
    ignoredNames = [ignoredNames];
  }
  results = [];
  for (i = 0, len = ignoredNames.length; i < len; i++) {
    ignoredName = ignoredNames[i];
    if (ignoredName) {
      try {
        ignoredPatterns.push(new Minimatch(ignoredName, {
          matchBase: true,
          dot: true
        }));
      } catch (err) {
        console.log(err, "Ftp-Remote-Edit: Error parsing ignore pattern (" + ignoredName + ")");
      }
    }
  }
  return ignoredPatterns;
};

exports.loadIgnoredPatterns = loadIgnoredPatterns;
var isPathIgnored = function isPathIgnored(filePath) {
  if (atom.config.get('ftp-remote-edit.tree.hideIgnoredNames')) {
    var _ignoredPatterns = loadIgnoredPatterns();
    for (i = 0, len = _ignoredPatterns.length; i < len; i++) {
      if (_ignoredPatterns[i].match(filePath)) {
        return true;
      }
    }
  }
  return false;
};

exports.isPathIgnored = isPathIgnored;
var resetIgnoredFinderPatterns = function resetIgnoredFinderPatterns() {
  ignoredFinderPatterns = null;
};

exports.resetIgnoredFinderPatterns = resetIgnoredFinderPatterns;
var loadIgnoredFinderPatterns = function loadIgnoredFinderPatterns() {
  var ignoredName = undefined,
      ignoredNames = undefined,
      ignoredCoreNames = undefined,
      ignoredFinderNames = undefined,
      i = undefined,
      len = undefined,
      results = undefined;

  if (ignoredFinderPatterns) return ignoredFinderPatterns;
  if (ignoredFinderPatterns == null) ignoredFinderPatterns = [];

  if (atom.config.get('ftp-remote-edit.tree.hideIgnoredNames')) {
    ignoredCoreNames = atom.config.get('core.ignoredNames') != null ? atom.config.get('core.ignoredNames') : [];
    if (typeof ignoredCoreNames === 'string') {
      ignoredCoreNames = [ignoredCoreNames];
    }
  } else {
    ignoredCoreNames = [];
  }

  ignoredFinderNames = atom.config.get('ftp-remote-edit.finder.ignoredNames') != null ? atom.config.get('ftp-remote-edit.finder.ignoredNames') : [];
  if (typeof ignoredFinderNames === 'string') {
    ignoredFinderNames = [ignoredFinderNames];
  }

  ignoredNames = [];
  ignoredNames = ignoredCoreNames.concat(ignoredFinderNames);

  results = [];
  for (i = 0, len = ignoredNames.length; i < len; i++) {
    ignoredName = ignoredNames[i];
    if (ignoredName) {
      try {
        ignoredFinderPatterns.push(new Minimatch(ignoredName, {
          matchBase: true,
          dot: true
        }));
      } catch (err) {
        console.log(err, "Ftp-Remote-Edit: Error parsing ignore pattern (" + ignoredName + ")");
      }
    }
  }
  return ignoredFinderPatterns;
};

exports.loadIgnoredFinderPatterns = loadIgnoredFinderPatterns;
var isFinderPathIgnored = function isFinderPathIgnored(filePath) {
  var ignoredPatterns = loadIgnoredFinderPatterns();
  for (i = 0, len = ignoredPatterns.length; i < len; i++) {
    if (ignoredPatterns[i].match(filePath)) {
      return true;
    }
  }

  return false;
};

exports.isFinderPathIgnored = isFinderPathIgnored;
var highlight = function highlight(path, matches, offsetIndex) {
  var lastIndex = 0;
  var matchedChars = [];
  var fragment = document.createDocumentFragment();
  for (var matchIndex of matches) {
    matchIndex -= offsetIndex;
    // If marking up the basename, omit path matches
    if (matchIndex < 0) {
      continue;
    }
    var unmatched = path.substring(lastIndex, matchIndex);
    if (unmatched) {
      if (matchedChars.length > 0) {
        var span = document.createElement('span');
        span.classList.add('character-match');
        span.textContent = matchedChars.join('');
        fragment.appendChild(span);
        matchedChars = [];
      }

      fragment.appendChild(document.createTextNode(unmatched));
    }

    matchedChars.push(path[matchIndex]);
    lastIndex = matchIndex + 1;
  }

  if (matchedChars.length > 0) {
    var span = document.createElement('span');
    span.classList.add('character-match');
    span.textContent = matchedChars.join('');
    fragment.appendChild(span);
  }

  // Remaining characters are plain text
  fragment.appendChild(document.createTextNode(path.substring(lastIndex)));
  return fragment;
};

exports.highlight = highlight;
var rightsToPermissions = function rightsToPermissions(rights) {
  var self = _this;

  if (!rights) return;

  var user = rights.user.split('');
  var group = rights.group.split('');
  var other = rights.other.split('');

  var permissionsuser = 0;
  var permissionsgroup = 0;
  var permissionsother = 0;

  user.forEach(function (right) {
    if (right == 'r') permissionsuser += 4;
    if (right == 'w') permissionsuser += 2;
    if (right == 'x') permissionsuser += 1;
  });

  group.forEach(function (right) {
    if (right == 'r') permissionsgroup += 4;
    if (right == 'w') permissionsgroup += 2;
    if (right == 'x') permissionsgroup += 1;
  });

  other.forEach(function (right) {
    if (right == 'r') permissionsother += 4;
    if (right == 'w') permissionsother += 2;
    if (right == 'x') permissionsother += 1;
  });

  return permissionsuser.toString() + permissionsgroup.toString() + permissionsother.toString();
};

exports.rightsToPermissions = rightsToPermissions;
var permissionsToRights = function permissionsToRights(permissions) {
  var self = _this;

  var groups = permissions.split('');

  var rights = {
    user: "",
    group: "",
    other: ""
  };

  if (groups[0] == 7) {
    rights.user += 'rwx';
  } else if (groups[0] == 6) {
    rights.user = 'rw';
  } else if (groups[0] == 5) {
    rights.user = 'rx';
  } else if (groups[0] == 4) {
    rights.user = 'r';
  } else if (groups[0] == 3) {
    rights.user = 'wx';
  } else if (groups[0] == 2) {
    rights.user = 'w';
  } else if (groups[0] == 1) {
    rights.user = 'x';
  } else if (groups[0] == 'x') {
    rights.user = self.rights.user;
  } else {
    rights.user = '';
  }

  if (groups[1] == 7) {
    rights.group += 'rwx';
  } else if (groups[1] == 6) {
    rights.group = 'rw';
  } else if (groups[1] == 5) {
    rights.group = 'rx';
  } else if (groups[1] == 4) {
    rights.group = 'r';
  } else if (groups[1] == 3) {
    rights.group = 'wx';
  } else if (groups[1] == 2) {
    rights.group = 'w';
  } else if (groups[1] == 1) {
    rights.group = 'x';
  } else if (groups[1] == 'x') {
    rights.group = self.rights.group;
  } else {
    rights.group = '';
  }

  if (groups[2] == 7) {
    rights.other += 'rwx';
  } else if (groups[2] == 6) {
    rights.other = 'rw';
  } else if (groups[2] == 5) {
    rights.other = 'rx';
  } else if (groups[2] == 4) {
    rights.other = 'r';
  } else if (groups[2] == 3) {
    rights.other = 'wx';
  } else if (groups[2] == 2) {
    rights.other = 'w';
  } else if (groups[2] == 1) {
    rights.other = 'x';
  } else if (groups[2] == 'x') {
    rights.other = self.rights.other;
  } else {
    rights.other = '';
  }

  return rights;
};

exports.permissionsToRights = permissionsToRights;
var getTextEditor = function getTextEditor(pathOnFileSystem) {
  var activate = arguments.length <= 1 || arguments[1] === undefined ? false : arguments[1];

  var foundEditor = null;
  var texteditors = atom.workspace.getTextEditors();
  texteditors.forEach(function (texteditor) {
    if (texteditor.getPath() == pathOnFileSystem) {
      foundEditor = texteditor;
      return false;
    }
  });

  if (activate && foundEditor) {
    pane = atom.workspace.paneForItem(foundEditor);
    if (pane) pane.activateItem(foundEditor);
  }

  return foundEditor;
};

exports.getTextEditor = getTextEditor;
var forEachAsync = function forEachAsync(array, callback) {
  return array.reduce(function (promise, item) {
    return promise.then(function (result) {
      return callback(item);
    });
  }, Promise.resolve());
};

exports.forEachAsync = forEachAsync;
// Return 1  if versionA > versionB
// Return 0  if versionA == versionB
// Return -1 if versionA < versionB
var compareVersions = function compareVersions(versionA, versionB) {
  if (versionA === versionB) {
    return 0;
  }

  var partsNumberA = versionA.split(".");
  var partsNumberB = versionB.split(".");

  for (var _i = 0; _i < partsNumberA.length; _i++) {
    var valueA = parseInt(partsNumberA[_i]);
    var valueB = parseInt(partsNumberB[_i]);

    if (valueA > valueB || isNaN(valueB)) {
      return 1;
    }
    if (valueA < valueB) {
      return -1;
    }
  }
};
exports.compareVersions = compareVersions;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2FuYW5tYXlqYWluLy5hdG9tL3BhY2thZ2VzL2Z0cC1yZW1vdGUtZWRpdC9saWIvaGVscGVyL2hlbHBlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxXQUFXLENBQUM7Ozs7Ozs7O0FBRVosSUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQztBQUN6QixJQUFNLElBQUksR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDN0IsSUFBTSxVQUFVLEdBQUcsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQ3RDLElBQU0sU0FBUyxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQyxTQUFTLENBQUM7O0FBRWpELElBQUksZUFBZSxHQUFHLElBQUksQ0FBQztBQUMzQixJQUFJLHFCQUFxQixHQUFHLElBQUksQ0FBQzs7QUFFMUIsSUFBTSxRQUFRLEdBQUcsU0FBWCxRQUFRLENBQUksTUFBTSxFQUFFLE1BQU0sRUFBSztBQUMxQyxNQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLDJCQUEyQixDQUFDLEVBQUU7QUFDaEQsUUFBSSxNQUFNLElBQUksTUFBTSxFQUFFO0FBQ3BCLGFBQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0tBQzdCLE1BQU0sSUFBSSxNQUFNLEVBQUU7QUFDakIsYUFBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztLQUNyQjtHQUNGO0NBQ0YsQ0FBQTs7O0FBRU0sSUFBTSxXQUFXLEdBQUcsU0FBZCxXQUFXLENBQUksR0FBRyxFQUFvQjtNQUFsQixJQUFJLHlEQUFHLE1BQU07O0FBQzVDLE1BQUksR0FBRyxZQUFZLEtBQUssRUFBRTtBQUN4QixPQUFHLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQztHQUNuQjs7QUFFRCxNQUFJLE9BQU8sR0FBRyxLQUFLLFFBQVEsRUFBRTtBQUMzQixPQUFHLEdBQUcsZUFBZSxDQUFDO0dBQ3ZCOztBQUVELE1B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QyxJQUFJLEdBQUcsSUFBSSxDQUFDO0dBQ3BCLE1BQU0sSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFO0FBQ3pCLFVBQU0sQ0FBQyxJQUFJLEdBQUcsR0FBRyxDQUFDO0dBQ25CLE1BQU0sSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFO0FBQ3pCLFVBQU0sQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO0dBQ3BCLE1BQU0sSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFO0FBQ3pCLFVBQU0sQ0FBQyxJQUFJLEdBQUcsR0FBRyxDQUFDO0dBQ25CLE1BQU0sSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFO0FBQ3pCLFVBQU0sQ0FBQyxJQUFJLEdBQUcsR0FBRyxDQUFDO0dBQ25CLE1BQU0sSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksR0FBRyxFQUFFO0FBQzNCLFVBQU0sQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUM7R0FDaEMsTUFBTTtBQUNMLFVBQU0sQ0FBQyxJQUFJLEdBQUcsRUFBRSxDQUFDO0dBQ2xCOztBQUVELE1BQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRTtBQUNsQixVQUFNLENBQUMsS0FBSyxJQUFJLEtBQUssQ0FBQztHQUN2QixNQUFNLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRTtBQUN6QixVQUFNLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztHQUNyQixNQUFNLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRTtBQUN6QixVQUFNLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztHQUNyQixNQUFNLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRTtBQUN6QixVQUFNLENBQUMsS0FBSyxHQUFHLEdBQUcsQ0FBQztHQUNwQixNQUFNLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRTtBQUN6QixVQUFNLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztHQUNyQixNQUFNLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRTtBQUN6QixVQUFNLENBQUMsS0FBSyxHQUFHLEdBQUcsQ0FBQztHQUNwQixNQUFNLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRTtBQUN6QixVQUFNLENBQUMsS0FBSyxHQUFHLEdBQUcsQ0FBQztHQUNwQixNQUFNLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLEdBQUcsRUFBRTtBQUMzQixVQUFNLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDO0dBQ2xDLE1BQU07QUFDTCxVQUFNLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztHQUNuQjs7QUFFRCxNQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUU7QUFDbEIsVUFBTSxDQUFDLEtBQUssSUFBSSxLQUFLLENBQUM7R0FDdkIsTUFBTSxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUU7QUFDekIsVUFBTSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7R0FDckIsTUFBTSxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUU7QUFDekIsVUFBTSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7R0FDckIsTUFBTSxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUU7QUFDekIsVUFBTSxDQUFDLEtBQUssR0FBRyxHQUFHLENBQUM7R0FDcEIsTUFBTSxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUU7QUFDekIsVUFBTSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7R0FDckIsTUFBTSxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUU7QUFDekIsVUFBTSxDQUFDLEtBQUssR0FBRyxHQUFHLENBQUM7R0FDcEIsTUFBTSxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUU7QUFDekIsVUFBTSxDQUFDLEtBQUssR0FBRyxHQUFHLENBQUM7R0FDcEIsTUFBTSxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxHQUFHLEVBQUU7QUFDM0IsVUFBTSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQztHQUNsQyxNQUFNO0FBQ0wsVUFBTSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7R0FDbkI7O0FBRUQsU0FBTyxNQUFNLENBQUM7Q0FDZixDQUFBOzs7QUFFTSxJQUFNLGFBQWEsR0FBRyxTQUFoQixhQUFhLENBQUksZ0JBQWdCLEVBQXVCO01BQXJCLFFBQVEseURBQUcsS0FBSzs7QUFDOUQsTUFBSSxXQUFXLEdBQUcsSUFBSSxDQUFDO0FBQ3ZCLE1BQUksV0FBVyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsY0FBYyxFQUFFLENBQUM7QUFDbEQsYUFBVyxDQUFDLE9BQU8sQ0FBQyxVQUFDLFVBQVUsRUFBSztBQUNsQyxRQUFJLFVBQVUsQ0FBQyxPQUFPLEVBQUUsSUFBSSxnQkFBZ0IsRUFBRTtBQUM1QyxpQkFBVyxHQUFHLFVBQVUsQ0FBQztBQUN6QixhQUFPLEtBQUssQ0FBQztLQUNkO0dBQ0YsQ0FBQyxDQUFDOztBQUVILE1BQUksUUFBUSxJQUFJLFdBQVcsRUFBRTtBQUMzQixRQUFJLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDLENBQUM7QUFDL0MsUUFBSSxJQUFJLEVBQUUsSUFBSSxDQUFDLFlBQVksQ0FBQyxXQUFXLENBQUMsQ0FBQztHQUMxQzs7QUFFRCxTQUFPLFdBQVcsQ0FBQztDQUNwQixDQUFBOzs7QUFFTSxJQUFNLFlBQVksR0FBRyxTQUFmLFlBQVksQ0FBSSxLQUFLLEVBQUUsUUFBUSxFQUFLO0FBQy9DLFNBQU8sS0FBSyxDQUFDLE1BQU0sQ0FBQyxVQUFDLE9BQU8sRUFBRSxJQUFJLEVBQUs7QUFDckMsV0FBTyxPQUFPLENBQUMsSUFBSSxDQUFDLFVBQUMsTUFBTSxFQUFLO0FBQzlCLGFBQU8sUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO0tBQ3ZCLENBQUMsQ0FBQztHQUNKLEVBQUUsT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7Q0FDdkIsQ0FBQTs7Ozs7O0FBS00sSUFBTSxlQUFlLEdBQUcsU0FBbEIsZUFBZSxDQUFJLFFBQVEsRUFBRSxRQUFRLEVBQUs7QUFDckQsTUFBSSxRQUFRLEtBQUssUUFBUSxFQUFFO0FBQ3pCLFdBQU8sQ0FBQyxDQUFDO0dBQ1Y7O0FBRUQsTUFBSSxZQUFZLEdBQUcsUUFBUSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUN2QyxNQUFJLFlBQVksR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDOztBQUV2QyxPQUFLLElBQUksRUFBQyxHQUFHLENBQUMsRUFBRSxFQUFDLEdBQUcsWUFBWSxDQUFDLE1BQU0sRUFBRSxFQUFDLEVBQUUsRUFBRTtBQUM1QyxRQUFJLE1BQU0sR0FBRyxRQUFRLENBQUMsWUFBWSxDQUFDLEVBQUMsQ0FBQyxDQUFDLENBQUM7QUFDdkMsUUFBSSxNQUFNLEdBQUcsUUFBUSxDQUFDLFlBQVksQ0FBQyxFQUFDLENBQUMsQ0FBQyxDQUFDOztBQUV2QyxRQUFJLE1BQU0sR0FBRyxNQUFNLElBQUksS0FBSyxDQUFDLE1BQU0sQ0FBQyxFQUFFO0FBQ3BDLGFBQU8sQ0FBQyxDQUFDO0tBQ1Y7QUFDRCxRQUFJLE1BQU0sR0FBRyxNQUFNLEVBQUU7QUFDbkIsYUFBTyxDQUFDLENBQUMsQ0FBQztLQUNYO0dBQ0Y7Q0FDRixDQUFBIiwiZmlsZSI6Ii9ob21lL2FuYW5tYXlqYWluLy5hdG9tL3BhY2thZ2VzL2Z0cC1yZW1vdGUtZWRpdC9saWIvaGVscGVyL2hlbHBlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2UgYmFiZWwnO1xuXG5jb25zdCBhdG9tID0gZ2xvYmFsLmF0b207XG5jb25zdCBQYXRoID0gcmVxdWlyZSgncGF0aCcpO1xuY29uc3QgRmlsZVN5c3RlbSA9IHJlcXVpcmUoJ2ZzLXBsdXMnKTtcbmNvbnN0IE1pbmltYXRjaCA9IHJlcXVpcmUoJ21pbmltYXRjaCcpLk1pbmltYXRjaDtcblxubGV0IGlnbm9yZWRQYXR0ZXJucyA9IG51bGw7XG5sZXQgaWdub3JlZEZpbmRlclBhdHRlcm5zID0gbnVsbDtcblxuZXhwb3J0IGNvbnN0IGxvZ0RlYnVnID0gKHBhcmFtMSwgcGFyYW0yKSA9PiB7XG4gIGlmIChhdG9tLmNvbmZpZy5nZXQoJ2Z0cC1yZW1vdGUtZWRpdC5kZXYuZGVidWcnKSkge1xuICAgIGlmIChwYXJhbTEgJiYgcGFyYW0yKSB7XG4gICAgICBjb25zb2xlLmxvZyhwYXJhbTEsIHBhcmFtMik7XG4gICAgfSBlbHNlIGlmIChwYXJhbTEpIHtcbiAgICAgIGNvbnNvbGUubG9nKHBhcmFtMSk7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBjb25zdCBzaG93TWVzc2FnZSA9IChtc2csIHR5cGUgPSAnaW5mbycpID0+IHtcbiAgaWYgKG1zZyBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgbXNnID0gbXNnLm1lc3NhZ2U7XG4gIH1cblxuICBpZiAodHlwZW9mIG1zZyAhPT0gJ3N0cmluZycpIHtcbiAgICBtc2cgPSAnVW5rbm93biBlcnJvcic7XG4gIH1cblxuICBpZiAodHlwZSA9PT0gJ3N1Y2Nlc3MnKSB7XG4gICAgYXRvbS5ub3RpZmljYXRpb25zLmFkZFN1Y2Nlc3MoJ0Z0cC1SZW1vdGUtRWRpdCcsIHtcbiAgICAgIGRlc2NyaXB0aW9uOiBtc2dcbiAgICB9KTtcbiAgfSBlbHNlIGlmICh0eXBlID09PSAnaW5mbycpIHtcbiAgICBhdG9tLm5vdGlmaWNhdGlvbnMuYWRkSW5mbygnRnRwLVJlbW90ZS1FZGl0Jywge1xuICAgICAgZGVzY3JpcHRpb246IG1zZ1xuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIGF0b20ubm90aWZpY2F0aW9ucy5hZGRFcnJvcignRnRwLVJlbW90ZS1FZGl0Jywge1xuICAgICAgZGVzY3JpcHRpb246IG1zZyxcbiAgICB9KTtcbiAgfVxufVxuXG5leHBvcnQgY29uc3QgZ2V0RnVsbEV4dGVuc2lvbiA9IChmaWxlUGF0aCkgPT4ge1xuICBsZXQgZnVsbEV4dGVuc2lvbiA9ICcnO1xuICBsZXQgZXh0ZW5zaW9uID0gJyc7XG4gIHdoaWxlIChleHRlbnNpb24gPSBQYXRoLmV4dG5hbWUoZmlsZVBhdGgpKSB7XG4gICAgZnVsbEV4dGVuc2lvbiA9IGV4dGVuc2lvbiArIGZ1bGxFeHRlbnNpb25cbiAgICBmaWxlUGF0aCA9IFBhdGguYmFzZW5hbWUoZmlsZVBhdGgsIGV4dGVuc2lvbilcbiAgfVxuICByZXR1cm4gZnVsbEV4dGVuc2lvbjtcbn1cblxuZXhwb3J0IGNvbnN0IGNyZWF0ZUxvY2FsUGF0aCA9IChsb2NhbHBhdGgpID0+IHtcbiAgdHJ5IHtcbiAgICBsZXQgYXJyUGF0aCA9IGxvY2FscGF0aC5zcGxpdChQYXRoLnNlcCk7XG4gICAgYXJyUGF0aC5wb3AoKTtcblxuICAgIGFyclBhdGgucmVkdWNlKCh0bXBQYXRoLCBkaXIpID0+IHtcbiAgICAgIHRtcFBhdGggKz0gUGF0aC5zZXAgKyBkaXI7XG4gICAgICBpZiAoIUZpbGVTeXN0ZW0uZXhpc3RzU3luYyh0bXBQYXRoKSkge1xuICAgICAgICBGaWxlU3lzdGVtLm1rZGlyU3luYyh0bXBQYXRoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0bXBQYXRoO1xuICAgIH0pO1xuICB9IGNhdGNoIChlcnIpIHsgcmV0dXJuIGVycjsgfVxufVxuXG5leHBvcnQgY29uc3QgZGVsZXRlTG9jYWxQYXRoID0gKGxvY2FscGF0aCkgPT4ge1xuICB0cnkge1xuICAgIGlmIChGaWxlU3lzdGVtLmV4aXN0c1N5bmMobG9jYWxwYXRoKSkge1xuICAgICAgRmlsZVN5c3RlbS5yZWFkZGlyU3luYyhsb2NhbHBhdGgpLmZvckVhY2goKGZpbGUsIGluZGV4KSA9PiB7XG4gICAgICAgIGxldCBjdXJQYXRoID0gbG9jYWxwYXRoICsgXCIvXCIgKyBmaWxlO1xuICAgICAgICBpZiAoRmlsZVN5c3RlbS5sc3RhdFN5bmMoY3VyUGF0aCkuaXNEaXJlY3RvcnkoKSkgeyAvLyByZWN1cnNlXG4gICAgICAgICAgcmV0dXJuIGRlbGV0ZUxvY2FsUGF0aChjdXJQYXRoKTtcbiAgICAgICAgfSBlbHNlIHsgLy8gZGVsZXRlIGZpbGVcbiAgICAgICAgICBGaWxlU3lzdGVtLnVubGlua1N5bmMoY3VyUGF0aCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgRmlsZVN5c3RlbS5ybWRpclN5bmMobG9jYWxwYXRoKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycikgeyByZXR1cm4gZXJyOyB9XG59XG5cbmV4cG9ydCBjb25zdCBtb3ZlTG9jYWxQYXRoID0gKHNyY2xvY2FscGF0aCwgdGFyZ2V0bG9jYWxwYXRoKSA9PiB7XG4gIHRyeSB7XG4gICAgbGV0IHRtcCA9IHRhcmdldGxvY2FscGF0aC5zcGxpdChQYXRoLnNlcCk7XG4gICAgdG1wLnBvcCgpO1xuICAgIGxldCBwYXJlbnRQYXRoID0gdG1wLmpvaW4oUGF0aC5zZXApO1xuXG4gICAgaWYgKCFGaWxlU3lzdGVtLmV4aXN0c1N5bmMocGFyZW50UGF0aCkpIHtcbiAgICAgIEZpbGVTeXN0ZW0ubWFrZVRyZWVTeW5jKHBhcmVudFBhdGgpO1xuICAgIH1cbiAgICBpZiAoRmlsZVN5c3RlbS5leGlzdHNTeW5jKHRhcmdldGxvY2FscGF0aCkpIHtcbiAgICAgIEZpbGVTeXN0ZW0ucmVtb3ZlU3luYyh0YXJnZXRsb2NhbHBhdGgpO1xuICAgIH1cbiAgICBGaWxlU3lzdGVtLm1vdmVTeW5jKHNyY2xvY2FscGF0aCwgdGFyZ2V0bG9jYWxwYXRoKTtcbiAgfSBjYXRjaCAoZXJyKSB7IHJldHVybiBlcnI7IH1cbn1cblxuZXhwb3J0IGNvbnN0IHJlc2V0SWdub3JlZFBhdHRlcm5zID0gKCkgPT4ge1xuICBpZ25vcmVkUGF0dGVybnMgPSBudWxsO1xufVxuXG5leHBvcnQgY29uc3QgbG9hZElnbm9yZWRQYXR0ZXJucyA9ICgpID0+IHtcbiAgbGV0IGlnbm9yZWROYW1lLCBpZ25vcmVkTmFtZXMsIGksIGxlbiwgcmVzdWx0cztcblxuICBpZiAoIWF0b20uY29uZmlnLmdldCgnZnRwLXJlbW90ZS1lZGl0LnRyZWUuaGlkZUlnbm9yZWROYW1lcycpKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKGlnbm9yZWRQYXR0ZXJucykgcmV0dXJuIGlnbm9yZWRQYXR0ZXJucztcbiAgaWYgKGlnbm9yZWRQYXR0ZXJucyA9PSBudWxsKSBpZ25vcmVkUGF0dGVybnMgPSBbXTtcblxuICBpZ25vcmVkTmFtZXMgPSAoYXRvbS5jb25maWcuZ2V0KCdjb3JlLmlnbm9yZWROYW1lcycpKSAhPSBudWxsID8gYXRvbS5jb25maWcuZ2V0KCdjb3JlLmlnbm9yZWROYW1lcycpIDogW107XG4gIGlmICh0eXBlb2YgaWdub3JlZE5hbWVzID09PSAnc3RyaW5nJykge1xuICAgIGlnbm9yZWROYW1lcyA9IFtpZ25vcmVkTmFtZXNdO1xuICB9XG4gIHJlc3VsdHMgPSBbXTtcbiAgZm9yIChpID0gMCwgbGVuID0gaWdub3JlZE5hbWVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgaWdub3JlZE5hbWUgPSBpZ25vcmVkTmFtZXNbaV07XG4gICAgaWYgKGlnbm9yZWROYW1lKSB7XG4gICAgICB0cnkge1xuICAgICAgICBpZ25vcmVkUGF0dGVybnMucHVzaChuZXcgTWluaW1hdGNoKGlnbm9yZWROYW1lLCB7XG4gICAgICAgICAgbWF0Y2hCYXNlOiB0cnVlLFxuICAgICAgICAgIGRvdDogdHJ1ZVxuICAgICAgICB9KSk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgY29uc29sZS5sb2coZXJyLCBcIkZ0cC1SZW1vdGUtRWRpdDogRXJyb3IgcGFyc2luZyBpZ25vcmUgcGF0dGVybiAoXCIgKyBpZ25vcmVkTmFtZSArIFwiKVwiKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIGlnbm9yZWRQYXR0ZXJucztcbn1cblxuZXhwb3J0IGNvbnN0IGlzUGF0aElnbm9yZWQgPSAoZmlsZVBhdGgpID0+IHtcbiAgaWYgKGF0b20uY29uZmlnLmdldCgnZnRwLXJlbW90ZS1lZGl0LnRyZWUuaGlkZUlnbm9yZWROYW1lcycpKSB7XG4gICAgbGV0IGlnbm9yZWRQYXR0ZXJucyA9IGxvYWRJZ25vcmVkUGF0dGVybnMoKTtcbiAgICBmb3IgKGkgPSAwLCBsZW4gPSBpZ25vcmVkUGF0dGVybnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgIGlmIChpZ25vcmVkUGF0dGVybnNbaV0ubWF0Y2goZmlsZVBhdGgpKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gZmFsc2U7XG59XG5cbmV4cG9ydCBjb25zdCByZXNldElnbm9yZWRGaW5kZXJQYXR0ZXJucyA9ICgpID0+IHtcbiAgaWdub3JlZEZpbmRlclBhdHRlcm5zID0gbnVsbDtcbn1cblxuZXhwb3J0IGNvbnN0IGxvYWRJZ25vcmVkRmluZGVyUGF0dGVybnMgPSAoKSA9PiB7XG4gIGxldCBpZ25vcmVkTmFtZSwgaWdub3JlZE5hbWVzLCBpZ25vcmVkQ29yZU5hbWVzLCBpZ25vcmVkRmluZGVyTmFtZXMsIGksIGxlbiwgcmVzdWx0cztcblxuICBpZiAoaWdub3JlZEZpbmRlclBhdHRlcm5zKSByZXR1cm4gaWdub3JlZEZpbmRlclBhdHRlcm5zO1xuICBpZiAoaWdub3JlZEZpbmRlclBhdHRlcm5zID09IG51bGwpIGlnbm9yZWRGaW5kZXJQYXR0ZXJucyA9IFtdO1xuXG4gIGlmIChhdG9tLmNvbmZpZy5nZXQoJ2Z0cC1yZW1vdGUtZWRpdC50cmVlLmhpZGVJZ25vcmVkTmFtZXMnKSkge1xuICAgIGlnbm9yZWRDb3JlTmFtZXMgPSAoYXRvbS5jb25maWcuZ2V0KCdjb3JlLmlnbm9yZWROYW1lcycpKSAhPSBudWxsID8gYXRvbS5jb25maWcuZ2V0KCdjb3JlLmlnbm9yZWROYW1lcycpIDogW107XG4gICAgaWYgKHR5cGVvZiBpZ25vcmVkQ29yZU5hbWVzID09PSAnc3RyaW5nJykge1xuICAgICAgaWdub3JlZENvcmVOYW1lcyA9IFtpZ25vcmVkQ29yZU5hbWVzXTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgaWdub3JlZENvcmVOYW1lcyA9IFtdO1xuICB9XG5cbiAgaWdub3JlZEZpbmRlck5hbWVzID0gKGF0b20uY29uZmlnLmdldCgnZnRwLXJlbW90ZS1lZGl0LmZpbmRlci5pZ25vcmVkTmFtZXMnKSkgIT0gbnVsbCA/IGF0b20uY29uZmlnLmdldCgnZnRwLXJlbW90ZS1lZGl0LmZpbmRlci5pZ25vcmVkTmFtZXMnKSA6IFtdO1xuICBpZiAodHlwZW9mIGlnbm9yZWRGaW5kZXJOYW1lcyA9PT0gJ3N0cmluZycpIHtcbiAgICBpZ25vcmVkRmluZGVyTmFtZXMgPSBbaWdub3JlZEZpbmRlck5hbWVzXTtcbiAgfVxuXG4gIGlnbm9yZWROYW1lcyA9IFtdO1xuICBpZ25vcmVkTmFtZXMgPSBpZ25vcmVkQ29yZU5hbWVzLmNvbmNhdChpZ25vcmVkRmluZGVyTmFtZXMpO1xuXG4gIHJlc3VsdHMgPSBbXTtcbiAgZm9yIChpID0gMCwgbGVuID0gaWdub3JlZE5hbWVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgaWdub3JlZE5hbWUgPSBpZ25vcmVkTmFtZXNbaV07XG4gICAgaWYgKGlnbm9yZWROYW1lKSB7XG4gICAgICB0cnkge1xuICAgICAgICBpZ25vcmVkRmluZGVyUGF0dGVybnMucHVzaChuZXcgTWluaW1hdGNoKGlnbm9yZWROYW1lLCB7XG4gICAgICAgICAgbWF0Y2hCYXNlOiB0cnVlLFxuICAgICAgICAgIGRvdDogdHJ1ZVxuICAgICAgICB9KSk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgY29uc29sZS5sb2coZXJyLCBcIkZ0cC1SZW1vdGUtRWRpdDogRXJyb3IgcGFyc2luZyBpZ25vcmUgcGF0dGVybiAoXCIgKyBpZ25vcmVkTmFtZSArIFwiKVwiKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIGlnbm9yZWRGaW5kZXJQYXR0ZXJucztcbn1cblxuZXhwb3J0IGNvbnN0IGlzRmluZGVyUGF0aElnbm9yZWQgPSAoZmlsZVBhdGgpID0+IHtcbiAgbGV0IGlnbm9yZWRQYXR0ZXJucyA9IGxvYWRJZ25vcmVkRmluZGVyUGF0dGVybnMoKTtcbiAgZm9yIChpID0gMCwgbGVuID0gaWdub3JlZFBhdHRlcm5zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgaWYgKGlnbm9yZWRQYXR0ZXJuc1tpXS5tYXRjaChmaWxlUGF0aCkpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBmYWxzZTtcbn1cblxuZXhwb3J0IGNvbnN0IGhpZ2hsaWdodCA9IChwYXRoLCBtYXRjaGVzLCBvZmZzZXRJbmRleCkgPT4ge1xuICBsZXQgbGFzdEluZGV4ID0gMDtcbiAgbGV0IG1hdGNoZWRDaGFycyA9IFtdO1xuICBjb25zdCBmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgZm9yIChsZXQgbWF0Y2hJbmRleCBvZiBtYXRjaGVzKSB7XG4gICAgbWF0Y2hJbmRleCAtPSBvZmZzZXRJbmRleDtcbiAgICAvLyBJZiBtYXJraW5nIHVwIHRoZSBiYXNlbmFtZSwgb21pdCBwYXRoIG1hdGNoZXNcbiAgICBpZiAobWF0Y2hJbmRleCA8IDApIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBjb25zdCB1bm1hdGNoZWQgPSBwYXRoLnN1YnN0cmluZyhsYXN0SW5kZXgsIG1hdGNoSW5kZXgpO1xuICAgIGlmICh1bm1hdGNoZWQpIHtcbiAgICAgIGlmIChtYXRjaGVkQ2hhcnMubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zdCBzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgICAgICBzcGFuLmNsYXNzTGlzdC5hZGQoJ2NoYXJhY3Rlci1tYXRjaCcpO1xuICAgICAgICBzcGFuLnRleHRDb250ZW50ID0gbWF0Y2hlZENoYXJzLmpvaW4oJycpO1xuICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChzcGFuKTtcbiAgICAgICAgbWF0Y2hlZENoYXJzID0gW107XG4gICAgICB9XG5cbiAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHVubWF0Y2hlZCkpXG4gICAgfVxuXG4gICAgbWF0Y2hlZENoYXJzLnB1c2gocGF0aFttYXRjaEluZGV4XSk7XG4gICAgbGFzdEluZGV4ID0gbWF0Y2hJbmRleCArIDE7XG4gIH1cblxuICBpZiAobWF0Y2hlZENoYXJzLmxlbmd0aCA+IDApIHtcbiAgICBjb25zdCBzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgIHNwYW4uY2xhc3NMaXN0LmFkZCgnY2hhcmFjdGVyLW1hdGNoJyk7XG4gICAgc3Bhbi50ZXh0Q29udGVudCA9IG1hdGNoZWRDaGFycy5qb2luKCcnKTtcbiAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChzcGFuKTtcbiAgfVxuXG4gIC8vIFJlbWFpbmluZyBjaGFyYWN0ZXJzIGFyZSBwbGFpbiB0ZXh0XG4gIGZyYWdtZW50LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHBhdGguc3Vic3RyaW5nKGxhc3RJbmRleCkpKTtcbiAgcmV0dXJuIGZyYWdtZW50O1xufVxuXG5leHBvcnQgY29uc3QgcmlnaHRzVG9QZXJtaXNzaW9ucyA9IChyaWdodHMpID0+IHtcbiAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cbiAgaWYgKCFyaWdodHMpIHJldHVybjtcblxuICBsZXQgdXNlciA9IHJpZ2h0cy51c2VyLnNwbGl0KCcnKTtcbiAgbGV0IGdyb3VwID0gcmlnaHRzLmdyb3VwLnNwbGl0KCcnKTtcbiAgbGV0IG90aGVyID0gcmlnaHRzLm90aGVyLnNwbGl0KCcnKTtcblxuICBsZXQgcGVybWlzc2lvbnN1c2VyID0gMDtcbiAgbGV0IHBlcm1pc3Npb25zZ3JvdXAgPSAwO1xuICBsZXQgcGVybWlzc2lvbnNvdGhlciA9IDA7XG5cbiAgdXNlci5mb3JFYWNoKChyaWdodCkgPT4ge1xuICAgIGlmIChyaWdodCA9PSAncicpIHBlcm1pc3Npb25zdXNlciArPSA0O1xuICAgIGlmIChyaWdodCA9PSAndycpIHBlcm1pc3Npb25zdXNlciArPSAyO1xuICAgIGlmIChyaWdodCA9PSAneCcpIHBlcm1pc3Npb25zdXNlciArPSAxO1xuICB9KTtcblxuICBncm91cC5mb3JFYWNoKChyaWdodCkgPT4ge1xuICAgIGlmIChyaWdodCA9PSAncicpIHBlcm1pc3Npb25zZ3JvdXAgKz0gNDtcbiAgICBpZiAocmlnaHQgPT0gJ3cnKSBwZXJtaXNzaW9uc2dyb3VwICs9IDI7XG4gICAgaWYgKHJpZ2h0ID09ICd4JykgcGVybWlzc2lvbnNncm91cCArPSAxO1xuICB9KTtcblxuICBvdGhlci5mb3JFYWNoKChyaWdodCkgPT4ge1xuICAgIGlmIChyaWdodCA9PSAncicpIHBlcm1pc3Npb25zb3RoZXIgKz0gNDtcbiAgICBpZiAocmlnaHQgPT0gJ3cnKSBwZXJtaXNzaW9uc290aGVyICs9IDI7XG4gICAgaWYgKHJpZ2h0ID09ICd4JykgcGVybWlzc2lvbnNvdGhlciArPSAxO1xuICB9KTtcblxuICByZXR1cm4gcGVybWlzc2lvbnN1c2VyLnRvU3RyaW5nKCkgKyBwZXJtaXNzaW9uc2dyb3VwLnRvU3RyaW5nKCkgKyBwZXJtaXNzaW9uc290aGVyLnRvU3RyaW5nKCk7XG59XG5cbmV4cG9ydCBjb25zdCBwZXJtaXNzaW9uc1RvUmlnaHRzID0gKHBlcm1pc3Npb25zKSA9PiB7XG4gIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gIGxldCBncm91cHMgPSBwZXJtaXNzaW9ucy5zcGxpdCgnJyk7XG5cbiAgbGV0IHJpZ2h0cyA9IHtcbiAgICB1c2VyOiBcIlwiLFxuICAgIGdyb3VwOiBcIlwiLFxuICAgIG90aGVyOiBcIlwiLFxuICB9XG5cbiAgaWYgKGdyb3Vwc1swXSA9PSA3KSB7XG4gICAgcmlnaHRzLnVzZXIgKz0gJ3J3eCc7XG4gIH0gZWxzZSBpZiAoZ3JvdXBzWzBdID09IDYpIHtcbiAgICByaWdodHMudXNlciA9ICdydyc7XG4gIH0gZWxzZSBpZiAoZ3JvdXBzWzBdID09IDUpIHtcbiAgICByaWdodHMudXNlciA9ICdyeCc7XG4gIH0gZWxzZSBpZiAoZ3JvdXBzWzBdID09IDQpIHtcbiAgICByaWdodHMudXNlciA9ICdyJztcbiAgfSBlbHNlIGlmIChncm91cHNbMF0gPT0gMykge1xuICAgIHJpZ2h0cy51c2VyID0gJ3d4JztcbiAgfSBlbHNlIGlmIChncm91cHNbMF0gPT0gMikge1xuICAgIHJpZ2h0cy51c2VyID0gJ3cnO1xuICB9IGVsc2UgaWYgKGdyb3Vwc1swXSA9PSAxKSB7XG4gICAgcmlnaHRzLnVzZXIgPSAneCc7XG4gIH0gZWxzZSBpZiAoZ3JvdXBzWzBdID09ICd4Jykge1xuICAgIHJpZ2h0cy51c2VyID0gc2VsZi5yaWdodHMudXNlcjtcbiAgfSBlbHNlIHtcbiAgICByaWdodHMudXNlciA9ICcnO1xuICB9XG5cbiAgaWYgKGdyb3Vwc1sxXSA9PSA3KSB7XG4gICAgcmlnaHRzLmdyb3VwICs9ICdyd3gnO1xuICB9IGVsc2UgaWYgKGdyb3Vwc1sxXSA9PSA2KSB7XG4gICAgcmlnaHRzLmdyb3VwID0gJ3J3JztcbiAgfSBlbHNlIGlmIChncm91cHNbMV0gPT0gNSkge1xuICAgIHJpZ2h0cy5ncm91cCA9ICdyeCc7XG4gIH0gZWxzZSBpZiAoZ3JvdXBzWzFdID09IDQpIHtcbiAgICByaWdodHMuZ3JvdXAgPSAncic7XG4gIH0gZWxzZSBpZiAoZ3JvdXBzWzFdID09IDMpIHtcbiAgICByaWdodHMuZ3JvdXAgPSAnd3gnO1xuICB9IGVsc2UgaWYgKGdyb3Vwc1sxXSA9PSAyKSB7XG4gICAgcmlnaHRzLmdyb3VwID0gJ3cnO1xuICB9IGVsc2UgaWYgKGdyb3Vwc1sxXSA9PSAxKSB7XG4gICAgcmlnaHRzLmdyb3VwID0gJ3gnO1xuICB9IGVsc2UgaWYgKGdyb3Vwc1sxXSA9PSAneCcpIHtcbiAgICByaWdodHMuZ3JvdXAgPSBzZWxmLnJpZ2h0cy5ncm91cDtcbiAgfSBlbHNlIHtcbiAgICByaWdodHMuZ3JvdXAgPSAnJztcbiAgfVxuXG4gIGlmIChncm91cHNbMl0gPT0gNykge1xuICAgIHJpZ2h0cy5vdGhlciArPSAncnd4JztcbiAgfSBlbHNlIGlmIChncm91cHNbMl0gPT0gNikge1xuICAgIHJpZ2h0cy5vdGhlciA9ICdydyc7XG4gIH0gZWxzZSBpZiAoZ3JvdXBzWzJdID09IDUpIHtcbiAgICByaWdodHMub3RoZXIgPSAncngnO1xuICB9IGVsc2UgaWYgKGdyb3Vwc1syXSA9PSA0KSB7XG4gICAgcmlnaHRzLm90aGVyID0gJ3InO1xuICB9IGVsc2UgaWYgKGdyb3Vwc1syXSA9PSAzKSB7XG4gICAgcmlnaHRzLm90aGVyID0gJ3d4JztcbiAgfSBlbHNlIGlmIChncm91cHNbMl0gPT0gMikge1xuICAgIHJpZ2h0cy5vdGhlciA9ICd3JztcbiAgfSBlbHNlIGlmIChncm91cHNbMl0gPT0gMSkge1xuICAgIHJpZ2h0cy5vdGhlciA9ICd4JztcbiAgfSBlbHNlIGlmIChncm91cHNbMl0gPT0gJ3gnKSB7XG4gICAgcmlnaHRzLm90aGVyID0gc2VsZi5yaWdodHMub3RoZXI7XG4gIH0gZWxzZSB7XG4gICAgcmlnaHRzLm90aGVyID0gJyc7XG4gIH1cblxuICByZXR1cm4gcmlnaHRzO1xufVxuXG5leHBvcnQgY29uc3QgZ2V0VGV4dEVkaXRvciA9IChwYXRoT25GaWxlU3lzdGVtLCBhY3RpdmF0ZSA9IGZhbHNlKSA9PiB7XG4gIGxldCBmb3VuZEVkaXRvciA9IG51bGw7XG4gIGxldCB0ZXh0ZWRpdG9ycyA9IGF0b20ud29ya3NwYWNlLmdldFRleHRFZGl0b3JzKCk7XG4gIHRleHRlZGl0b3JzLmZvckVhY2goKHRleHRlZGl0b3IpID0+IHtcbiAgICBpZiAodGV4dGVkaXRvci5nZXRQYXRoKCkgPT0gcGF0aE9uRmlsZVN5c3RlbSkge1xuICAgICAgZm91bmRFZGl0b3IgPSB0ZXh0ZWRpdG9yO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfSk7XG5cbiAgaWYgKGFjdGl2YXRlICYmIGZvdW5kRWRpdG9yKSB7XG4gICAgcGFuZSA9IGF0b20ud29ya3NwYWNlLnBhbmVGb3JJdGVtKGZvdW5kRWRpdG9yKTtcbiAgICBpZiAocGFuZSkgcGFuZS5hY3RpdmF0ZUl0ZW0oZm91bmRFZGl0b3IpO1xuICB9XG5cbiAgcmV0dXJuIGZvdW5kRWRpdG9yO1xufVxuXG5leHBvcnQgY29uc3QgZm9yRWFjaEFzeW5jID0gKGFycmF5LCBjYWxsYmFjaykgPT4ge1xuICByZXR1cm4gYXJyYXkucmVkdWNlKChwcm9taXNlLCBpdGVtKSA9PiB7XG4gICAgcmV0dXJuIHByb21pc2UudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICByZXR1cm4gY2FsbGJhY2soaXRlbSk7XG4gICAgfSk7XG4gIH0sIFByb21pc2UucmVzb2x2ZSgpKTtcbn1cblxuLy8gUmV0dXJuIDEgIGlmIHZlcnNpb25BID4gdmVyc2lvbkJcbi8vIFJldHVybiAwICBpZiB2ZXJzaW9uQSA9PSB2ZXJzaW9uQlxuLy8gUmV0dXJuIC0xIGlmIHZlcnNpb25BIDwgdmVyc2lvbkJcbmV4cG9ydCBjb25zdCBjb21wYXJlVmVyc2lvbnMgPSAodmVyc2lvbkEsIHZlcnNpb25CKSA9PiB7XG4gIGlmICh2ZXJzaW9uQSA9PT0gdmVyc2lvbkIpIHtcbiAgICByZXR1cm4gMDtcbiAgfVxuXG4gIGxldCBwYXJ0c051bWJlckEgPSB2ZXJzaW9uQS5zcGxpdChcIi5cIik7XG4gIGxldCBwYXJ0c051bWJlckIgPSB2ZXJzaW9uQi5zcGxpdChcIi5cIik7XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYXJ0c051bWJlckEubGVuZ3RoOyBpKyspIHtcbiAgICBsZXQgdmFsdWVBID0gcGFyc2VJbnQocGFydHNOdW1iZXJBW2ldKTtcbiAgICBsZXQgdmFsdWVCID0gcGFyc2VJbnQocGFydHNOdW1iZXJCW2ldKTtcblxuICAgIGlmICh2YWx1ZUEgPiB2YWx1ZUIgfHwgaXNOYU4odmFsdWVCKSkge1xuICAgICAgcmV0dXJuIDE7XG4gICAgfVxuICAgIGlmICh2YWx1ZUEgPCB2YWx1ZUIpIHtcbiAgICAgIHJldHVybiAtMTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==